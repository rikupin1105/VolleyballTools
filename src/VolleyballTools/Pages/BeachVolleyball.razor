@page "/scoresheetBeach"
@using VolleyballTools.Model;
@inject IJSRuntime JS
@inject PDF.PDF PDF

<style>
    h3 {
        font-weight: 700;
    }

    .form-label {
        margin-bottom: .2rem;
        font-weight: 600 !important;
    }

    .form-support {
        margin-bottom: .2rem;
        color: #626264;
    }
</style>

<h3>ビーチバレーボール スコアシートを作成する</h3>
<p class="form-support">印刷後に記入する箇所は空欄にしてください</p>

<div class="mb-3 mt-3">
    <label class="form-label fw-bold">試合名</label>
    <input type="text" @bind="beachMatch.MatchName" class="form-control" id="exampleFormControlInput1">
</div>

<div class="mb-3">
    <p class="form-label fw-bold">開催地</p>
    <input type="text" @bind="beachMatch.Venue" class="form-control" id="exampleFormControlInput1">
</div>

<div class="mb-3">
    <p class="form-label">会場名</p>
    <input type="text" @bind="beachMatch.Hall" class="form-control" id="exampleFormControlInput1">
</div>

<div class="mb-3">
    <p class="form-label">開催日</p>
    <input type="date" @bind="beachMatch.DateTime" class="form-control" id="exampleFormControlInput1">
</div>

<div class="mb-3">
    <p class="form-label">試合番号</p>
    <input type="text" @bind="beachMatch.MatchNumber" class="form-control" id="exampleFormControlInput1">
</div>


<div class="card mb-3">
    <div class="mb-3 card-body">
        <p class="form-label mb-3">Aチーム</p>
        <div class="mb-1">
            <p class="form-label">チーム名</p>
            <input type="text" @bind="beachMatch.ATeam.Name" class="form-control">
        </div>
        <div class="mb-1">
            <p class="form-label">都道府県</p>
            <input type="text" @bind="beachMatch.ATeam.Prefecture" class="form-control">
        </div>

        <div class="row me-1">
            <div class="col-3">
                <p class="form-label">番号</p>
            </div>

            <div class="col-9">
                <p class="form-label">名前</p>
            </div>

            <div class="mb-1 col-3">
                <input type="number" @bind="beachMatch.ATeam.Player1.Number" class="form-control">
            </div>

            <div class="mb-1 col-9">
                <input type="text" @bind="beachMatch.ATeam.Player1.Name" class="form-control">
            </div>

            <div class="mb-1 col-3">
                <input type="number" @bind="beachMatch.ATeam.Player2.Number" class="form-control">
            </div>

            <div class="mb-1 col-9">
                <input type="text" @bind="beachMatch.ATeam.Player2.Name" class="form-control">
            </div>
        </div>
    </div>
</div>

<div class="card mb-3">
    <div class="mb-3 card-body">
        <p class="form-label mb-3">Bチーム</p>
        <div class="mb-1">
            <p class="form-label">チーム名</p>
            <input type="text" @bind="beachMatch.BTeam.Name" class="form-control">
        </div>
        <div class="mb-1">
            <p class="form-label">都道府県</p>
            <input type="text" @bind="beachMatch.BTeam.Prefecture" class="form-control">
        </div>

        <div class="row me-1">
            <div class="col-3">
                <p class="form-label">番号</p>
            </div>

            <div class="col-9">
                <p class="form-label">名前</p>
            </div>

            <div class="mb-1 col-3">
                <input type="number" @bind="beachMatch.BTeam.Player1.Number" class="form-control">
            </div>

            <div class="mb-1 col-9">
                <input type="text" @bind="beachMatch.BTeam.Player1.Name" class="form-control">
            </div>

            <div class="mb-1 col-3">
                <input type="number" @bind="beachMatch.BTeam.Player2.Number" class="form-control">
            </div>

            <div class="mb-1 col-9">
                <input type="text" @bind="beachMatch.BTeam.Player2.Name" class="form-control">
            </div>
        </div>
    </div>
</div>

<div class="mb-3">
    <label for="exampleFormControlInput1" class="form-label">性別</label>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="GenderRadio" @onclick="@(()=>beachMatch.Sex = Sex.Men)" id="SexRadio1">
        <label class="form-check-label" for="SexRadio1">
            男子
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="GenderRadio" @onclick="@(()=>beachMatch.Sex = Sex.Women)" id="SexRadio2">
        <label class="form-check-label" for="SexRadio2">
            女子
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="GenderRadio" @onclick="@(()=>beachMatch.Sex = null)" id="SexRadio3" checked>
        <label class="form-check-label" for="SexRadio3">
            未選択
        </label>
    </div>
</div>

<div class="mb-3">
    <label for="exampleFormControlInput1" class="form-label">本戦/予選</label>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="RoundRadio" @onclick="@(()=>beachMatch.Round = Round.Final )" id="RoundRadio1">
        <label class="form-check-label" for="RoundRadio1">
            本戦
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="RoundRadio" @onclick="@(()=>beachMatch.Round = Round.Qualification)" id="RoundRadio2">
        <label class="form-check-label" for="RoundRadio2">
            予選
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="RoundRadio" @onclick="@(()=>beachMatch.Round = null)" id="RoundRadio3" checked>
        <label class="form-check-label" for="RoundRadio3">
            未選択
        </label>
    </div>
</div>

<div class="mb-3">
    <label for="exampleFormControlInput1" class="form-label">本戦/予選</label>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="StageRadio" @onclick="@(()=>beachMatch.Stage = Stage.Pool )" id="StageRadio1">
        <label class="form-check-label" for="StageRadio1">
            プール選
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="StageRadio" @onclick="@(()=>beachMatch.Stage = Stage.Rank)" id="StageRadio2">
        <label class="form-check-label" for="StageRadio2">
            順位
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="StageRadio" @onclick="@(()=>beachMatch.Stage = Stage.SemiFinal)" id="StageRadio3">
        <label class="form-check-label" for="StageRadio3">
            準決勝
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="StageRadio" @onclick="@(()=>beachMatch.Stage = Stage.Final)" id="StageRadio4">
        <label class="form-check-label" for="StageRadio4">
            決勝
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="StageRadio" @onclick="@(()=>beachMatch.Stage = null)" id="StageRadio5" checked>
        <label class="form-check-label" for="StageRadio5">
            未選択
        </label>
    </div>
</div>

<button class="btn btn-primary mb-3 px-5" @onclick="IncrementCount">生成</button>

@code {
    public int SET { get; set; } = 1;

    public BeachMatch beachMatch = new();
    public class BeachMatch : Match
    {
        public Team ATeam { get; set; } = new();
        public Team BTeam { get; set; } = new();
        public Round? Round { get; set; } = null;
        public Stage? Stage { get; set; } = null;
    }
    public class Team
    {
        public string? Name { get; set; }
        public string? Prefecture { get; set; }

        public Player Player1 { get; set; } = new();
        public Player Player2 { get; set; } = new();
    }

    private async void IncrementCount()
    {
        var fileStream = PDF.GenerateBeach1SET(beachMatch);
        await DownloadFileFromStream(fileStream);
    }

    private async Task DownloadFileFromStream(Stream fileStream)
    {
        var fileName = $"Scoresheet.pdf";
        if (beachMatch.MatchName is not null)
        {
            fileName = $"{beachMatch.MatchName}-{fileName}";
        }

        using var streamRef = new DotNetStreamReference(stream: fileStream);

        await JS.InvokeVoidAsync("downloadFileFromStream", fileName, streamRef);

        streamRef.Dispose();
    }
}
